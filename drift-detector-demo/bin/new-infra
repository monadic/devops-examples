#!/bin/bash

if [ ! -e ".cub-project" ]; then
  echo "No space prefix found. Run bin/install-base first."
  exit 1
fi

project=$(cat .cub-project)

if [ -z "$1" ]; then
  echo "Usage: $0 <env-name>"
  exit 1
fi

name=$1

# Clone namespace unit from base
cub unit create ns-$name --space $project-infra --upstream-unit ns-base --label type=infra,targetable=true

# Update namespace name for this environment
cub unit update ns-$name --space $project-infra --patch --data "{\"metadata\":{\"name\":\"$project-$name\"}}"
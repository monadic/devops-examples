#!/bin/bash

# Induce drift by changing units in ConfigHub (following the pattern)

if [ ! -e ".cub-project" ]; then
  echo "No space prefix found. Run bin/install-base first."
  exit 1
fi

project=$(cat .cub-project)
env=${1:-dev}

echo "Inducing drift in $project-$env environment..."
echo ""

# Change backend-api replicas to create drift
echo "Changing backend-api from 3 to 5 replicas..."
echo '{"spec":{"replicas":5}}' | cub unit update backend-api --space $project-$env --patch --from-stdin

# Note: Without proper targets set up, we'll demonstrate drift detection
# by showing the ConfigHub state change

echo ""
echo "Drift induced! backend-api now has 5 replicas (base expects 3)"
echo ""
echo "Check the dashboard: http://localhost:8082"
echo "The drift detector should show the discrepancy"
#!/bin/bash

# Clean up all ConfigHub resources created by this example

set -e

if [ ! -e ".cub-project" ]; then
  echo "No project file found"
  exit 0
fi

project=$(cat .cub-project)

echo "⚠️  WARNING: This will delete all ConfigHub spaces and units for project: $project"
echo "Press Ctrl+C to cancel or Enter to continue..."
read

echo "Deleting spaces..."

# Delete in reverse order (downstream first)
for env in us-prod eu-prod asia-prod prod staging dev base filters; do
  space=$project-$env
  if [ "$env" == "base" ] || [ "$env" == "filters" ]; then
    space=$project-$env
  else
    space=$project-$env
  fi

  echo "Deleting space: $space"
  cub space delete $space --force 2>/dev/null || true
done

# Delete main space
echo "Deleting main space: $project"
cub space delete $project --force 2>/dev/null || true

# Clean up Kubernetes resources
echo "Cleaning up Kubernetes resources..."
kubectl delete namespace devops-apps --ignore-not-found=true

# Remove project file
rm -f .cub-project

echo "✅ Cleanup complete"